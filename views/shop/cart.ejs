<%- include('../layouts/shop-layout', {
  title: 'Your Cart',
  body: `
  <section class="container py-5">

    <h4 class="mb-4">Your Cart</h4>

    ${
      session && session.checkoutBlocked
        ? `
        <div class="alert alert-warning d-flex justify-content-between align-items-center">
          <span>You must be logged in to checkout.</span>
          <div>
            <a href="/signup" class="btn btn-sm btn-dark">Sign up</a>
            <a href="/user/login" class="btn btn-sm btn-outline-dark">Login</a>
          </div>
        </div>
        `
        : ``
    }

    ${
      items.length === 0
        ? `<p class="text-muted">Your cart is empty.</p>`
        : `
        <div class="cart-list">

          ${items.map(item => `
            <div class="cart-item d-flex gap-3 align-items-center mb-3">

              <img
                src="/uploads/${item.image || 'no-image.png'}"
                width="80"
                alt="${item.name}"
              >

              <div class="flex-grow-1">
                <div class="fw-semibold">${item.name}</div>
                <div class="text-muted">₱${item.price}</div>

                <div class="d-flex align-items-center gap-2 mt-2">

                  <form method="POST" action="/cart/decrease">
                    <input type="hidden" name="id" value="${item.id}">
                    <button type="submit" class="btn btn-sm btn-outline-secondary">−</button>
                  </form>

                  <span>${item.qty}</span>

                  <form method="POST" action="/cart/increase">
                    <input type="hidden" name="id" value="${item.id}">
                    <button type="submit" class="btn btn-sm btn-outline-secondary">+</button>
                  </form>

                </div>
              </div>

              <div class="fw-semibold">
                ₱${item.price * item.qty}
              </div>

              <form method="POST" action="/cart/remove">
                <input type="hidden" name="id" value="${item.id}">
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  Remove
                </button>
              </form>

            </div>
          `).join('')}

        </div>

        <hr>

        <div class="d-flex justify-content-between align-items-center">
          <h5>Total</h5>
          <h5>₱${total}</h5>
        </div>

        <div class="d-flex justify-content-between mt-4">
          <a href="/shop" class="btn btn-outline-dark">
            Continue Shopping
          </a>

          <!-- ✅ POST checkout gate -->
          <form method="POST" action="/cart/checkout">
            <button type="submit" class="btn btn-dark">
              Proceed to Checkout
            </button>
          </form>
        </div>
        `
    }

  </section>
  `
}) %>
